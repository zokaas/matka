import{j as t}from"./jsx-runtime-u17CrQMm.js";import{a as w}from"./chunk-WWGJGFF6-CEBmBqlZ.js";const M=({className:e,children:s})=>e?t.jsx("div",{className:e,children:s}):t.jsx("div",{children:s}),F=({children:e,className:s,showAs:n})=>n&&n==="span"?t.jsx("span",{className:s,children:e}):t.jsx("p",{className:s,children:e});var D="_17x5a000",fe="_17x5a001",me="_17x5a002",G="_1yi33w0",K="_1yi33w2",$="_1yi33w3 _1wan2qm0",H="_1wan2qm0";const Q=({label:e,onClick:s,type:n,className:o,disabled:c,ariaLabel:d})=>{const l=o||H;return t.jsx("button",{type:n,disabled:c,className:l,onClick:()=>s?.(),"aria-label":d,children:e})},V={"sweden-b2b-application":"https://www.opr.se",fi:"https://www.yritysluotto.fi",default:"https://en.opr-finance.fi"};function _(){typeof window<"u"&&window.localStorage&&window.localStorage.clear()}function A(e){const n=`${localStorage.getItem("loginUrl")??""}/${e??""}`;_(),window.location.replace(n)}function J(e="default"){_();const s=V[e.toLowerCase()];s&&window.location.assign(s)}const W={404:{message:"Page not found",label:"Login"},500:{message:"Something went wrong",label:"Login"},440:{message:"Session expired",label:"Login"},401:{message:"Not authorized",label:"Login"},400:{message:"Bad request",label:"Login"}},pe=({status:e,message:s,statusMessages:n})=>{const o=String(e),c=n?.[o],d=W[o],l=c?.message||d?.message||s,g=c?.label||d?.label||"Log in",m=()=>{const i=localStorage.getItem("applicationId")||null;A(i)};return t.jsx(X,{status:e,message:l,children:t.jsx(Q,{type:"button",className:$,label:g,onClick:m})})},X=({message:e,children:s})=>t.jsx(M,{className:D,children:t.jsxs(M,{className:G,children:[t.jsx(F,{className:K,children:e}),s]})});var Y="_4bz3f50",Z="_4bz3f51",ee="_4bz3f52",se="_4bz3f53",te="_4bz3f54",ne="_4bz3f55";const oe=e=>{const{isOpen:s,title:n,description:o,firstActionText:c,firstAction:d,secondActionText:l,secondAction:g,isLoading:m,classNames:i}=e;if(!s)return null;const T=i?.modalOverlay||Y,h=i?.modalContentContainer||Z,y=i?.modalTitle||ee,C=i?.modalDescription||se,x=i?.modalActionBlock||te,p=i?.modalButton||ne;return t.jsx("div",{className:T,children:t.jsxs("div",{className:h,children:[t.jsx("h2",{className:y,children:n}),o&&t.jsx("p",{className:C,children:o}),t.jsxs("div",{className:x,children:[t.jsx("button",{className:p,onClick:d,disabled:m,children:c}),l&&g&&t.jsx("button",{className:p,onClick:g,disabled:m,children:l})]})]})})},ge=async()=>{try{console.log("[requestSessionRefresh] Refreshing session via BFF...");const e=await fetch("/refresh-session",{method:"POST",credentials:"include",headers:{Accept:"application/json"}});if(!e.ok)return console.warn("[requestSessionRefresh] failed:",e.status),null;const s=await e.json();let n=s?.exp;if(typeof n!="number")return null;n<1e12&&(n=n*1e3);const o=s?.sessionRefreshCount;return typeof o!="number"?null:{exp:n,sessionRefreshCount:o}}catch(e){return console.error("[requestSessionRefresh] Error:",e),null}};async function re(){try{await fetch("/end-session",{method:"POST",credentials:"same-origin"})}catch(e){console.error("Failed to end session",e)}}function we(e){typeof window>"u"||window.dispatchEvent(new CustomEvent("session:modal:show",{detail:e}))}function ae({error:e}){throw e}function ie({response:e}){throw e}const he=({refreshTitle:e,refreshDescription:s,continueSessionButton:n,expiredTitle:o,expiredDescription:c,loginButton:d,logoutButton:l,sessionData:g})=>{const{applicationId:m,productId:i}=g,[T,h]=w.useState(!1),[y,C]=w.useState(void 0),[x,p]=w.useState(!1),[S,E]=w.useState(null),v=w.useRef(null),j=()=>{const u=m??localStorage.getItem("applicationId");R(()=>A(u))},B=y==="expired"?{title:o,description:c,continueButton:d,logoutButton:l}:{title:e,description:s,continueButton:n,logoutButton:l},{title:N,description:I,continueButton:k,logoutButton:q}=B,b=()=>{v.current&&(clearTimeout(v.current),v.current=null)};w.useEffect(()=>{const u=r=>{const a=r.detail;C(a.type),h(!0);const f=Math.max(5e3,typeof a.remainingMs=="number"?a.remainingMs:6e4);b(),v.current=setTimeout(()=>j(),f)};return window.addEventListener("session:modal:show",u),()=>{window.removeEventListener("session:modal:show",u),b()}},[m]);const R=async u=>{if(!x){b(),p(!0);try{await re()}catch(r){console.error("Logout request failed:",r)}finally{try{h(!1),u()}finally{p(!1)}}}},U=async()=>{if(b(),y==="expired")return console.log("Expired, redirect to login page","start/"),j();p(!0),console.log("Continue session (UI requests manager to refresh)");const u=(r=15e3)=>new Promise(a=>{let f=null;const L=P=>{f&&(clearTimeout(f),f=null);const O=P.detail??{};window.removeEventListener("session:refresh-response",L),a(O)};window.addEventListener("session:refresh-response",L),f=setTimeout(()=>{window.removeEventListener("session:refresh-response",L),a({success:!1,response:new Response("Session refresh timeout",{status:504,statusText:"Gateway Timeout"})})},r),window.dispatchEvent(new CustomEvent("session:refresh-request"))});try{const{success:r,response:a}=await u(15e3);if(!r){const f=a instanceof Response?a:new Response("Session refresh failed",{status:401,statusText:"Unauthorized"});E(f);return}h(!1)}catch(r){console.error("handleContinue unexpected error",r);const a=r instanceof Error?r.message:"Unknown error during refresh";E(new Response(a,{status:500,statusText:"Session Refresh Error"}))}finally{p(!1)}},z=async()=>{R(()=>J(i))};return S?S instanceof Response?t.jsx(ie,{response:S}):t.jsx(ae,{error:S}):t.jsx(oe,{isOpen:T,title:N,description:I,firstActionText:k,secondActionText:q,firstAction:U,secondAction:z,isLoading:x})};export{Q as B,M as C,pe as E,he as S,F as T,fe as a,X as b,me as f,D as m,ge as r,we as s};
