import{a as u,q as T,w as A,t as C,O as b,v as D,x as k,i as N,M as _,L as q,S as B,y as U}from"./chunk-WWGJGFF6-CEBmBqlZ.js";import{j as r}from"./jsx-runtime-u17CrQMm.js";import{r as F,s as P,E as V}from"./SessionModalManager-C4fSKPVD.js";function L(s){const e=s.toLowerCase();return e.includes("sweden")||e.includes("se")?"sv":e.includes("finland")||e.includes("fi")?"fi":"en"}const G="/assets/global-mVfkxMrT.css";var H="_1dfwfod0",M="_944cwd0";function O(s){return{"sweden-b2b-application":M}[s]||M}function W(s=1e3){const e=u.useRef(Date.now()),o=u.useRef(Date.now());return u.useEffect(()=>{const f=()=>{const t=Date.now();t-o.current>=s&&(e.current=t,o.current=t)},a=[{name:"mousemove"},{name:"keydown"},{name:"touchstart",options:{passive:!0}},{name:"touchmove",options:{passive:!0}},{name:"scroll",options:{passive:!0}}];return a.forEach(({name:t,options:c})=>window.addEventListener(t,f,c)),()=>{a.forEach(({name:t,options:c})=>window.removeEventListener(t,f,c))}},[s]),{getLastActivity:()=>e.current,lastActivityRef:e}}function Y({expiresAtMs:s,getLastActivity:e,refreshCount:o,maxRefresh:l,onAttemptRefresh:f,onShowModal:a,onFatal:t,now:c}){const d=u.useRef(null),m=u.useRef(0),v=u.useRef(null),R=()=>typeof document<"u"&&document.visibilityState==="visible";u.useEffect(()=>{if(!s)return;m.current=s;const y=Math.max(0,s-c()-6e4);d.current&&clearTimeout(d.current);const h=s,n=async()=>{if(m.current!==h||v.current===h)return;if(v.current=h,o>=l){const i=Math.max(0,h-c());console.log("expiring",i),a({type:"expired",remainingMs:i});return}if(!R()){const i=()=>{document.removeEventListener("visibilitychange",i),m.current===h&&n()};document.addEventListener("visibilitychange",i,{once:!0});return}if(c()-e()<3e4)try{if(!await f()){const g=new Response("Session refresh failed",{status:401,statusText:"Session refresh failed"});t(g);return}}catch(i){console.error("[useExpiryTimer] refresh error",i);const g=i instanceof Error?i.message:"Unknown refresh error",j=new Response(g,{status:401,statusText:"Session refresh error"});t(j)}else{const i=Math.max(5e3,h-c());a({type:"refresh",remainingMs:i})}};return y===0?n():d.current=setTimeout(n,y),()=>{d.current&&(clearTimeout(d.current),d.current=null)}},[s,o,l,e,f,a,t,c])}const $=()=>{const s=T(),{exp:e,sessionRefreshCount:o,maxSessionRefresh:l}=s,f=()=>Date.now(),[a,t]=u.useState(e??0),[c,d]=u.useState(o??0),{getLastActivity:m}=W(),[v,R]=u.useState(null),E=async()=>{try{const n=await F();return n?(t(n.exp),d(n.sessionRefreshCount),n):null}catch(n){return console.error("attemptRefresh error",n),null}};return u.useEffect(()=>{const n=async()=>{try{const p=await E();if(!p){const x=new Response("Session refresh failed",{status:401,statusText:"Unauthorized"});window.dispatchEvent(new CustomEvent("session:refresh-response",{detail:{success:!1,response:x}}));return}window.dispatchEvent(new CustomEvent("session:refresh-response",{detail:{success:!0,result:p}}))}catch(p){console.error("[useSessionManager] refresh on request failed:",p);const x=p instanceof Error?p.message:"Unknown refresh error",S=new Response(x,{status:500,statusText:"Session Refresh Error"});window.dispatchEvent(new CustomEvent("session:refresh-response",{detail:{success:!1,response:S}}))}};return window.addEventListener("session:refresh-request",n),()=>{window.removeEventListener("session:refresh-request",n)}},[E]),Y({expiresAtMs:a,getLastActivity:m,refreshCount:c,maxRefresh:l??1,onAttemptRefresh:E,onShowModal:n=>P(n),onFatal:n=>{R(n)},now:f}),v},w="sweden-b2b-application",ee=()=>[{rel:"stylesheet",href:G}],se={id:"root"};function I({children:s,theme:e=w,lang:o="en"}){const l=O(e);return r.jsxs("html",{lang:o,"data-theme":e,children:[r.jsxs("head",{children:[r.jsx("meta",{charSet:"utf-8"}),r.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),r.jsx(_,{}),r.jsx(q,{})]}),r.jsxs("body",{className:`${l} ${H}`,children:[s,r.jsx(B,{}),r.jsx(U,{})]})]})}function z({response:s}){throw s}function J(){const s=$();return s?r.jsx(z,{response:s}):null}function K(){return!!T()?.sessionId?r.jsx(J,{}):null}const te=A(function(){const e=T(),o=L(e?.productId||w);return r.jsxs(I,{theme:e?.theme||w,lang:o,children:[r.jsx(K,{}),r.jsx(b,{})]})}),ne=C(function(){const e=D(),o=k("root"),l=L(o?.productId||w);let f=500,a="Unknown error",t={};return N(e)?(f=e.status,a=e.statusText||"Route Error response",t=e.data):e instanceof Error?(a=e.message||"Application error",t={stack:e.stack}):t={raw:e},r.jsx(I,{theme:w,lang:l,children:r.jsx(V,{status:f,message:a,data:t,statusMessages:o?.statusMessages})})});export{ne as ErrorBoundary,te as default,se as handle,ee as links};
