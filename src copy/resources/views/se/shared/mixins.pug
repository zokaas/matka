mixin questionLabel(questionLabel)
	if questionLabel
		p.body_text_bold= questionLabel

mixin getAnswerText(questionKey)
	- const answers = data?.questionAnswers?.answers_data?.answers || [];
	- const found = answers.find(a => a.question === questionKey);
	- const result = found ? found.answerText || '' : '';
	if found 
		span.body_text  #{result}
	else
		span.body_text Ej angivet

mixin answerText(answerText)
	if answerText
		.answer-content
			if Array.isArray(answerText) && typeof answerText[0] === 'object'
				each obj, index in answerText
					.object-block
						p.object-number #{index + 1}.
						- const entries = Object.entries(obj)
						each entry, i in entries
							- const key = entry[0]
							- const val = entry[1]
							p.object-kv #{key}: #{val}#{i < entries.length - 1 ? ',' : ''}
			else
				p.body_text= answerText

mixin questionAnswerRow(answerObject)
	if answerObject
		tr
			td.table_question
				+questionLabel(answerObject.questionLabel)
			td.table_answer
				.answer-cell
				if answerObject.answerText
					+answerText(answerObject.answerText)
				else
					p.body_text (Inget svar)

// Mixin to render BeneficialOwners from representative
mixin renderBeneficialOwnersRepresentative(data)
	- const CompanyBOArray = data.filter(ans => ans.question === "CompanyBO").map(ans => ans.answerText || []).filter(Boolean)

	if CompanyBOArray.length
		each boSet, setIndex in CompanyBOArray
			each boObj, boIndex in boSet
				.object-block
					p.object-number #{boIndex + 1}.
					p.object-kv Namn: #{boObj.BOName}
					p.object-kv Personnummer: #{boObj.BOSSN}
					p.object-kv Bosatt i: #{boObj.BOCountry}
					p.object-kv Ägarandel: #{boObj.BOownership}
					p.object-kv Är PEP: #{boObj.BOPEP === "1" ? "Ja" : "Nej"}
	else
		p.body_text Inga verkliga huvudmän angivna.

// Mixin to render BeneficialOwners from SwedishCompaniesRegistrationOffice
mixin renderBeneficialOwnersFromAuthorities(data)
	- const orgNumber = (data.organizationNumber || '').replace(/\D/g, '')
	- const orgs = data.CM1Response.SwedishCompaniesRegistrationOffice?.Organizations || []
	- const organization = orgs.find(org => (org.OrganizationNumber || '').replace(/\D/g, '') === orgNumber)
	
	if organization && organization.BeneficialOwners.length
		each owner, index in organization.BeneficialOwners
			.object-block
				p.object-number #{index + 1}.
				
				- const fullName = [owner.FirstName, owner.MiddleName, owner.LastName].filter(Boolean).join(' ')
				p.object-kv Namn: #{fullName}
				p.object-kv Personnummer: #{owner.PersonNumber}
				p.object-kv Bosatt i: #{owner.CountryOfResidence}
				p.object-kv Medborgarskap: #{owner.Citizenship}

				// Controls
				if owner.Controls.length
					- const controlTexts = owner.Controls.map(c => c.Code + (c.Association?.CompanyName ? ` (${c.Association.CompanyName})` : '')).join(', ')
					p.object-kv Kontrollerar: #{controlTexts}
				else
					p.object-kv Kontrollerar: -
	else
		p.body_text Inga verkliga huvudmän hittades för denna organisation.